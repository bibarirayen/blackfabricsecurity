<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold">Manage Checkpoints</h3>
    <button class="btn btn-primary" (click)="openAddModal()">+ Add Checkpoint</button>
  </div>
<!-- Filter Section -->
  <div class="d-flex flex-wrap gap-2 mb-3 align-items-center">
    <input type="text" class="form-control" style="max-width: 250px;" placeholder="Search by checkpoint name..." [(ngModel)]="searchName" />
    
    <select class="form-select" style="max-width: 200px;" [(ngModel)]="selectedClient">
      <option value="">All Clients</option>
      <option *ngFor="let client of clients" [value]="client.name">{{ client.name }}</option>
    </select>
      <div class="ms-auto">

    <button class="btn btn-secondary" (click)="applyFilter()">Apply Filter</button>
    </div>
  </div>
  <div class="table-responsive">
    <table class="table table-hover text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Location</th>
        <td>Client Name</td>

          <th>Verification</th>

          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of checkpoints">
          <td>{{ c.name }}</td>
          <td>{{ c.location }}</td>
                    <td>{{ c.clientName }}</td>

          <td>{{ c.verificationType }}</td>
          <td>
            <button class="btn btn-sm btn-outline-info me-2" (click)="openViewModal(c)">View</button>
            <button class="btn btn-sm btn-outline-success me-2" (click)="openEditModal(c)">Edit</button>
            <button class="btn btn-sm btn-outline-danger" (click)="deleteCheckpoint(c.name)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add/Edit Modal -->
  <div class="modal-backdrop fade show" *ngIf="showModal"></div>
  <div class="modal fade show d-block" tabindex="-1" *ngIf="showModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header">
          <h5 class="modal-title">{{ isEditing ? 'Edit Checkpoint' : 'Add Checkpoint' }}</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="row">
              
              <div class=" mb-3">
                <label class="form-label">Name</label>
                <input type="text" class="form-control" [(ngModel)]="newCheckpoint.name" name="name">
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Location</label>
              <input type="text" class="form-control" [(ngModel)]="newCheckpoint.location" name="location">
            </div>

            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" rows="3" [(ngModel)]="newCheckpoint.description" name="description"></textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">Verification Type</label>
              <select class="form-select" [(ngModel)]="newCheckpoint.verificationType" name="verificationType">
                <option value="QR Scan">QR Scan</option>
                <option value="NFC">NFC</option>
                <option value="Manual Check">Manual Check</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Client</label>
              <select class="form-select" style="max-width: 200px;" [(ngModel)]="selectedClient">
      <option value="">All Clients</option>
      <option *ngFor="let client of clients" [value]="client.name">{{ client.name }}</option>
    </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Upload Photos</label>
              <input type="file" class="form-control" (change)="onPhotoUpload($event)" multiple>
              <div class="d-flex flex-wrap gap-2 mt-2">
                <img *ngFor="let photo of newCheckpoint.photos" [src]="photo" width="80" height="80" class="rounded shadow-sm border">
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveCheckpoint()">{{ isEditing ? 'Update' : 'Add' }}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- View Modal -->
  <div class="modal-backdrop fade show" *ngIf="showViewModal"></div>
  <div class="modal fade show d-block" tabindex="-1" *ngIf="showViewModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header">
          <h5 class="modal-title">Checkpoint Details</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body" *ngIf="selectedCheckpoint">
          <p><strong>Traject ID:</strong> {{ selectedCheckpoint.trajectId }}</p>
          <p><strong>Name:</strong> {{ selectedCheckpoint.name }}</p>
          <p><strong>Location:</strong> {{ selectedCheckpoint.location }}</p>
          <p><strong>Verification:</strong> {{ selectedCheckpoint.verificationType }}</p>
          <p><strong>Description:</strong> {{ selectedCheckpoint.description }}</p>

          <div class="mt-3">
            <label class="fw-bold">Photos:</label>
            <div class="d-flex flex-wrap gap-2 mt-2">
              <img *ngFor="let img of selectedCheckpoint.photos" [src]="img" width="100" height="100" class="rounded shadow-sm border">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
