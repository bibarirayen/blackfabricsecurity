<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold">Manage Trajects</h3>
    <button class="btn btn-primary" (click)="openAddModal()">+ Add Traject</button>
  </div>
  <!-- Filter Row -->
<div class="d-flex align-items-center mb-3 gap-2 flex-wrap">
  <input type="text" class="form-control" style="max-width: 200px;" placeholder="Search by name..." [(ngModel)]="searchName">
  
  <select class="form-select" style="max-width: 200px;" [(ngModel)]="selectedClientId">
    <option value="All Clients">All Clients</option>
    <option *ngFor="let client of clients" [value]="client.id">{{ client.name }}</option>
  </select>

  <div class="ms-auto">
    <button class="btn btn-secondary" (click)="applyFilter()">Apply Filter</button>
  </div>
</div>

  <div class="table-responsive">
    <table class="table table-striped align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Duration</th>
          <th>Client</th>
          <th>Checkpoints</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let t of trajects">
          <td>{{ t.name }}</td>
          <td>{{ t.description }}</td>
          <td>{{ t.duration }}</td>
          <td>{{ t.client?.name || '‚Äî' }}</td>
          <td>
            <ul class="list-unstyled mb-0">
              <li *ngFor="let c of t.checkpoints">
                <small>üìç {{ c.name }} ({{ c.verificationType }})</small>
              </li>
            </ul>
          </td>
          <td>
            <button class="btn btn-sm btn-outline-success me-2" (click)="openEditModal(t)">Edit</button>
            <button class="btn btn-sm btn-outline-danger" (click)="deleteTraject(t.id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop fade show" *ngIf="showModal"></div>
  <div class="modal fade show d-block" tabindex="-1" *ngIf="showModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header">
          <h5 class="modal-title">{{ isEditing ? 'Edit Traject' : 'Add Traject' }}</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>

        <div class="modal-body">
          <form>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Name</label>
                <input type="text" class="form-control" [(ngModel)]="newTraject.name" name="name">
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Duration</label>
                <input type="text" class="form-control" [(ngModel)]="newTraject.duration" name="duration">
              </div>
            </div>

            <div class="row">
              <div class="col-md-12 mb-3">
                <label class="form-label">Client</label>
                <select class="form-select" [(ngModel)]="newTraject.clientId" name="clientId">
                  <option value="" disabled selected>Select Client</option>
                  <option *ngFor="let client of clients" [value]="client.id">
                    {{ client.name }}
                  </option>
                </select>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" rows="2" [(ngModel)]="newTraject.description" name="description"></textarea>
            </div>

            <hr>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="fw-bold mb-0">Checkpoints</h6>
              <button type="button" class="btn btn-sm btn-outline-primary" (click)="addCheckpoint()">+ Add Checkpoint</button>
            </div>

            <div *ngFor="let checkpoint of newTraject.checkpoints; let i = index" class="border rounded p-3 mb-2">
              <div class="row align-items-center g-2">
                <div class="col-md-4">
                  <input type="text" class="form-control" placeholder="Checkpoint Name" [(ngModel)]="checkpoint.name" name="name{{i}}">
                </div>
                <div class="col-md-4">
                  <input type="text" class="form-control" placeholder="Location" [(ngModel)]="checkpoint.location" name="location{{i}}">
                </div>
                <div class="col-md-3">
                  <select class="form-select" [(ngModel)]="checkpoint.verificationType" name="verificationType{{i}}">
                    <option value="QR Scan">QR Scan</option>
                    <option value="NFC">NFC</option>
                    <option value="Manual Check">Manual Check</option>
                  </select>
                </div>
                <div class="col-md-1 text-end">
                  <button class="btn btn-sm btn-outline-danger" (click)="removeCheckpoint(i)" type="button">‚úñ</button>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveTraject()">
            {{ isEditing ? 'Update' : 'Add' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
