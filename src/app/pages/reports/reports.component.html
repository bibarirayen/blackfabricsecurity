<div class="container mt-5">
    <h2 class="fw-bold">Reports Management</h2>

  <!-- Filter Form -->
  <form [formGroup]="filterForm" class="row g-3 mb-4 p-3 shadow-sm rounded bg-light">
    <div class="col-md-2">
      <input type="text" class="form-control form-control-sm" placeholder="Client" formControlName="client" />
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control form-control-sm" placeholder="Officer" formControlName="officer" />
    </div>
    <div class="col-md-2">
      <select class="form-select form-select-sm" formControlName="reportType">
        <option value="">All Types</option>
        <option *ngFor="let t of reportTypes">{{ t }}</option>
      </select>
    </div>
    <div class="col-md-2">
      <input type="date" class="form-control form-control-sm" formControlName="dateFrom" />
    </div>
    <div class="col-md-2">
      <input type="date" class="form-control form-control-sm" formControlName="dateTo" />
    </div>
    <div class="col-md-2 d-flex gap-2">
      <button type="button" class="btn btn-primary btn-sm flex-fill" (click)="applyFilter()">Apply</button>
      <button type="reset" class="btn btn-outline-secondary btn-sm flex-fill">Reset</button>
    </div>
  </form>

  <!-- Reports Table -->
  <div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Client</th>
          <th>Officer</th>
          <th>Type</th>
          <th>Date Entered</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let report of reports">
          <td>{{ report.id }}</td>
          <td>{{ report.client }}</td>
          <td>{{ report.officer }}</td>
          <td>{{ report.type }}</td>
          <td>{{ report.dateEntered | date:'mediumDate' }}</td>
          <td class="d-flex gap-1 flex-wrap">
            <button class="btn btn-info btn-sm" (click)="openView(report)">View</button>
            <button class="btn btn-warning btn-sm" (click)="openEdit(report)">Edit</button>
            <button class="btn btn-danger btn-sm" (click)="deleteReport(report)">Delete</button>
            <button class="btn btn-success btn-sm" (click)="markReviewed(report)">Reviewed</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

<!-- View Modal -->
<div class="modal fade show" tabindex="-1" [ngClass]="{'d-block': viewModalOpen}" style="background: rgba(0,0,0,0.5)">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content shadow-lg rounded">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">View Report</h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeView()"></button>
      </div>
      <div class="modal-body" *ngIf="selectedReport">

        <!-- Basic Info -->
        <div class="row mb-3">
          <div class="col-md-4 mb-2 text-center">
            <span class="badge bg-secondary w-100 fs-6">Client</span>
            <div class="p-2 border rounded text-center">{{ selectedReport.client }}</div>
          </div>
          <div class="col-md-4 mb-2 text-center">
            <span class="badge bg-secondary w-100 fs-6">Officer</span>
            <div class="p-2 border rounded text-center">{{ selectedReport.officer }}</div>
          </div>
          <div class="col-md-4 mb-2 text-center">
            <span class="badge bg-secondary w-100 fs-6">Site</span>
            <div class="p-2 border rounded text-center">{{ selectedReport.site }}</div>
          </div>
          <div class="col-md-4 mb-2 text-center">
            <span class="badge bg-secondary w-100 fs-6">Date Entered</span>
            <div class="p-2 border rounded text-center">{{ selectedReport.dateEntered | date:'short' }}</div>
          </div>
        </div>

        <!-- Dynamic Fields by Type -->
        <div class="row g-2 mb-3">
          <ng-container [ngSwitch]="selectedReport.type">

            <!-- Incident Report -->
            <ng-container *ngSwitchCase="'Incident Report'">
              <div class="col-md-6 mb-2 text-center" *ngFor="let key of ['incidentInternalId','incidentDateTime','incidentType','victimName','victimContact','suspectName','suspectContact','witnessNames','incidentLocation','incidentSummary','responderPoliceNames','responderFireTruck','responderAmbulance','incidentDetails','incidentActions']">
                <span class="badge bg-info w-100 fs-6">{{ key }}</span>
                <div class="p-2 border rounded text-center">{{ selectedReport[key] }}</div>
              </div>
              <div class="col-md-6 mb-2 text-center">
                <span class="badge bg-info w-100 fs-6">Police Called</span>
                <div class="p-2 border rounded text-center">{{ selectedReport.policeCalled ? 'Yes' : 'No' }}</div>
              </div>
            </ng-container>

            <!-- Daily Activity Report -->
            <ng-container *ngSwitchCase="'Daily Activity Report'">
              <div class="col-md-6 mb-2 text-center" *ngFor="let key of ['dailyShiftStartNotes','dailyPostShift','dailySpecialInstructions','dailyPostItemsReceived','dailyObservations','dailyRelievingFirst','dailyRelievingLast','dailyAdditionalNotes']">
                <span class="badge bg-info w-100 fs-6">{{ key }}</span>
                <div class="p-2 border rounded text-center">{{ selectedReport[key] }}</div>
              </div>
            </ng-container>

            <!-- Maintenance Report -->
            <ng-container *ngSwitchCase="'Maintenance Report'">
              <div class="col-md-6 mb-2 text-center" *ngFor="let key of ['maintenanceType','maintenanceDetails','maintenanceWhoNotified']">
                <span class="badge bg-info w-100 fs-6">{{ key }}</span>
                <div class="p-2 border rounded text-center">{{ selectedReport[key] }}</div>
              </div>
              <div class="col-md-6 mb-2 text-center">
                <span class="badge bg-info w-100 fs-6">Email Client</span>
                <div class="p-2 border rounded text-center">{{ selectedReport.maintenanceEmailClient ? 'Yes' : 'No' }}</div>
              </div>
            </ng-container>

            <!-- Parking Violation Report -->
            <ng-container *ngSwitchCase="'Parking Violation Report'">
              <div class="col-md-6 mb-2 text-center" *ngFor="let key of ['violatorFirst','violatorLast','vehicleMake','vehicleModel','vehicleLP','vehicleVIN','vehicleColor','violationType','violationNumber','parkingLocation','parkingFine','parkingDetails']">
                <span class="badge bg-info w-100 fs-6">{{ key }}</span>
                <div class="p-2 border rounded text-center">{{ selectedReport[key] }}</div>
              </div>
              <div class="col-md-6 mb-2 text-center">
                <span class="badge bg-info w-100 fs-6">Vehicle Towed</span>
                <div class="p-2 border rounded text-center">{{ selectedReport.vehicleTowed ? 'Yes' : 'No' }}</div>
              </div>
            </ng-container>

          </ng-container>
        </div>

        <!-- Images Gallery -->
        <div class="mt-3 text-center">
          <h6>Images</h6>
          <div class="d-flex flex-wrap justify-content-center gap-2 p-2 border rounded" style="max-height:200px; overflow-y:auto;">
            <img *ngFor="let img of selectedReport.images" [src]="img" class="border rounded shadow-sm" width="120" height="120" />
          </div>
        </div>

      </div>
    </div>
  </div>
</div>


  <!-- Edit Modal -->
  <div class="modal fade show" tabindex="-1" [ngClass]="{'d-block': editModalOpen}" style="background: rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content shadow-lg rounded">
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title">Edit Report</h5>
          <button type="button" class="btn-close" (click)="closeEdit()"></button>
        </div>
        <div class="modal-body" *ngIf="selectedReport">
          <form class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Client</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="selectedReport.client" name="client"/>
            </div>
            <div class="col-md-4">
              <label class="form-label">Officer</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="selectedReport.officer" name="officer"/>
            </div>
            <div class="col-md-4">
              <label class="form-label">Site</label>
              <input type="text" class="form-control form-control-sm" [(ngModel)]="selectedReport.site" name="site"/>
            </div>
            <div class="col-md-4">
              <label class="form-label">Date Entered</label>
              <input type="date" class="form-control form-control-sm" [(ngModel)]="selectedReport.dateEntered" name="dateEntered"/>
            </div>

            <!-- Dynamic Fields by Report Type -->
            <ng-container [ngSwitch]="selectedReport.type">
              <ng-container *ngSwitchCase="'Incident Report'">
                <div class="col-md-4" *ngFor="let key of ['incidentInternalId','incidentDateTime','incidentType','victimName','victimContact','suspectName','suspectContact','witnessNames','incidentLocation','incidentSummary','responderPoliceNames','responderFireTruck','responderAmbulance','incidentDetails','incidentActions']">
                  <label class="form-label">{{ key }}</label>
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="selectedReport[key]" [name]="key"/>
                </div>
                <div class="col-md-4 mt-2">
                  <label class="form-label">Police Called</label>
                  <input type="checkbox" [(ngModel)]="selectedReport.policeCalled" name="policeCalled"/>
                </div>
              </ng-container>

              <ng-container *ngSwitchCase="'Daily Activity Report'">
                <div class="col-md-4" *ngFor="let key of ['dailyShiftStartNotes','dailyPostShift','dailySpecialInstructions','dailyPostItemsReceived','dailyObservations','dailyRelievingFirst','dailyRelievingLast','dailyAdditionalNotes']">
                  <label class="form-label">{{ key }}</label>
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="selectedReport[key]" [name]="key"/>
                </div>
              </ng-container>

              <ng-container *ngSwitchCase="'Maintenance Report'">
                <div class="col-md-4" *ngFor="let key of ['maintenanceType','maintenanceDetails','maintenanceWhoNotified']">
                  <label class="form-label">{{ key }}</label>
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="selectedReport[key]" [name]="key"/>
                </div>
                <div class="col-md-4 mt-2">
                  <label class="form-label">Email Client</label>
                  <input type="checkbox" [(ngModel)]="selectedReport.maintenanceEmailClient" name="maintenanceEmailClient"/>
                </div>
              </ng-container>

              <ng-container *ngSwitchCase="'Parking Violation Report'">
                <div class="col-md-4" *ngFor="let key of ['violatorFirst','violatorLast','vehicleMake','vehicleModel','vehicleLP','vehicleVIN','vehicleColor','violationType','violationNumber','parkingLocation','parkingFine','parkingDetails']">
                  <label class="form-label">{{ key }}</label>
                  <input type="text" class="form-control form-control-sm" [(ngModel)]="selectedReport[key]" [name]="key"/>
                </div>
                <div class="col-md-4 mt-2">
                  <label class="form-label">Vehicle Towed</label>
                  <input type="checkbox" [(ngModel)]="selectedReport.vehicleTowed" name="vehicleTowed"/>
                </div>
              </ng-container>
            </ng-container>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary btn-sm" (click)="saveEdit()">Save</button>
          <button class="btn btn-secondary btn-sm" (click)="closeEdit()">Cancel</button>
        </div>
      </div>
    </div>
  </div>

</div>
