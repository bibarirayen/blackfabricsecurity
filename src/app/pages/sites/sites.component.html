<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold">Manage Sites</h3>
    <button class="btn btn-primary" (click)="openAddModal()">+ Add Site</button>
  </div>

  <!-- Filter Section -->
  <div class="d-flex flex-wrap gap-2 mb-3 align-items-center">
    <input type="text" class="form-control" style="max-width: 250px;" placeholder="Search by site name..." [(ngModel)]="searchTerm">
    
    <select class="form-select" style="max-width: 200px;" [(ngModel)]="selectedClient">
      <option value="">All Clients</option>
      <option *ngFor="let c of clients" [value]="c">{{ c }}</option>
    </select>

    <div class="ms-auto">
      <button class="btn btn-secondary" (click)="applyFilter()">Apply Filter</button>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-hover text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>Site Name</th>
          <th>Location</th>
          <th>Client</th>
          <th>Description</th>
          <th>Floor</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let site of filteredSites">
          <td>{{ site.name }}</td>
          <td>{{ site.location }}</td>
          <td>{{ site.client }}</td>
          <td>{{ site.description }}</td>
          <td>{{ site.floor }}</td>
          <td>
            <button class="btn btn-sm btn-outline-info me-2" (click)="openViewModal(site)">View</button>
            <button class="btn btn-sm btn-outline-success me-2" (click)="openEditModal(site)">Edit</button>
            <button class="btn btn-sm btn-outline-danger" (click)="deleteSite(site.id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Add/Edit Modal -->
  <div class="modal-backdrop fade show" *ngIf="showAddEditModal"></div>
  <div class="modal fade show d-block" tabindex="-1" *ngIf="showAddEditModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header">
          <h5 class="modal-title">{{ editMode ? 'Edit Site' : 'Add Site' }}</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="siteForm">
            <div class="mb-3">
              <label class="form-label">Site Name</label>
              <input type="text" class="form-control" formControlName="name">
            </div>

            <div class="mb-3">
              <label class="form-label">Location</label>
              <input type="text" class="form-control" formControlName="location">
            </div>

            <div class="mb-3">
              <label class="form-label">Client</label>
              <select class="form-select" formControlName="client">
                <option *ngFor="let c of clients" [value]="c">{{ c }}</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" rows="3" formControlName="description"></textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">Floor</label>
              <input type="text" class="form-control" formControlName="floor">
            </div>

            <div class="mb-3">
              <label class="form-label">Upload Photos</label>
              <input type="file" class="form-control" (change)="onPhotoUpload($event)" multiple>
              <div class="d-flex flex-wrap gap-2 mt-2">
                <img *ngFor="let photo of siteForm.value.photos" [src]="photo" width="80" height="80" class="rounded shadow-sm border">
              </div>
            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveSite()">{{ editMode ? 'Update' : 'Add' }}</button>
        </div>
      </div>
    </div>
  </div>

  <!-- View Modal -->
  <div class="modal-backdrop fade show" *ngIf="showViewModal"></div>
  <div class="modal fade show d-block" tabindex="-1" *ngIf="showViewModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header">
          <h5 class="modal-title">Site Details</h5>
          <button type="button" class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body" *ngIf="selectedSite">
          <p><strong>Name:</strong> {{ selectedSite.name }}</p>
          <p><strong>Location:</strong> {{ selectedSite.location }}</p>
          <p><strong>Client:</strong> {{ selectedSite.client }}</p>
          <p><strong>Description:</strong> {{ selectedSite.description }}</p>
          <p><strong>Floor:</strong> {{ selectedSite.floor }}</p>

          <div class="mt-3">
            <label class="fw-bold">Photos:</label>
            <div class="d-flex flex-wrap gap-2 mt-2">
              <img *ngFor="let photo of selectedSite.photos" [src]="photo" width="100" height="100" class="rounded shadow-sm border">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
